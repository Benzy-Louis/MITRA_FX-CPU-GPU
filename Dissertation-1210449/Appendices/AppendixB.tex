% Appendix B

\chapter{DiFX - Custom documentation}
\label{AppendixB}
\lhead{Appendix B. \emph{DiFX - Custom documentation}}

\section{DiFX - Preliminary setup}
[Vague content just to fill in, following$\ldots$]\\
To install the diFX-2.3 software correlator do the following things,
\begin{enumerate}
\item Download the source of the software somewhere using the following command
\begin{verbatim}
svn co https://svn.atnf.csiro.au/difx/master_tags/DiFX-2.3
\end{verbatim}

\item Install IPP, i.e.
\begin{verbatim}
>> cd $IPP_PATH
>> chmod +x install.sh
>> ./install.sh
\end{verbatim}

\item Install PGPLOT, following the instructions of the following website:\\
\url{http://pendientedemigracion.ucm.es/info/Astrof/software/howto/howto-pgplot.html}\\
Do the following,
\begin{verbatim}
>> cd /usr/local/src
>> mv ~/Downloads/pgplot5.2.tar.gz .
>> tar zxvf pgplot5.2.tar.gz
>> mkdir /usr/local/pgplot
>> cd /usr/local/pgplot
>> cp /usr/local/src/pgplot/drivers.list 
>> /usr/local/src/pgplot/makemake
 /usr/local/src/pgplot linux g77_gcc_aout
\end{verbatim}

Edit the file makefile
\begin{verbatim}
>> sudo gedit makefile &
\end{verbatim}
Change
\begin{verbatim}
FCOMPL=g77
# to 
FCOMPL=gfortran
\end{verbatim}
Then save, and compile
\begin{verbatim}
>> make
>> make cpg
>> make clean
\end{verbatim}
Export the paths
\begin{verbatim}
>> export PGPLOT_DIR=/usr/local/pgplot
>> export PGPLOT_DEV=/Xserve
\end{verbatim}

\item Install OpenMPI also.

\item Then go back to install diFX-2.3, edit the setup.bash file,
\begin{verbatim}
>> cd $DIFX_ROOT
>> sudo gedit setup.bash &
\end{verbatim}
\item Change the following paths environment variables, an  example  here for my setup,
\begin{verbatim}
####### ROOT PATHS ##########################
export DIFXROOT=/home/ruben/Final_Year_Project/DiFX/DiFX-2.3
export DIFX_PREFIX=$DIFXROOT
export PGPLOTDIR=/usr/local/pgplot/
export IPPROOT=/opt/intel/ipp/bin/

####### COMPILER ############################
export MPICXX=/usr/local/bin/mpicxx

# ALSO UNCOMMENT THESE THINGS ALSO

####### PORTS FOR DIFXMESSAGE ###############
# Uncomment these to enable DIFX_MESSAGES
export DIFX_MESSAGE_GROUP=224.2.2.1
export DIFX_MESSAGE_PORT=50201
export DIFX_BINARY_GROUP=224.2.2.1
export DIFX_BINARY_PORT=50202

\end{verbatim}
\item use the geniepc script with input the path /opt/intel
\begin{verbatim}
$DIFXROOT/applications/difx_monitor
\end{verbatim} 



\item Then we can start the installation of DiFX-2.3, go back to the root folder of diFX, and do the following,
\begin{verbatim}
>> source setup.bash
>> ./install-difx
\end{verbatim}

\item Now for the preliminary tests I have not automated the scripts which would allow me to run diFX without having to send out preliminary parameters first. To be able to use the program one must set up the RPC. So the rpcbind package has to be installed.

\item To make rpcbind work,
\begin{verbatim}
>> sudo -i service portmap stop
>> sudo -i rpcbind -i -w
>> sudo -i service portmap start 
\end{verbatim}

Then we can start the calculation server and check it for the host,
\begin{verbatim}
>> startCalcServer
>> checkCalcServer 127.0.0.1
# Setting up the CALC_SERVER environment variable to the local host
>> export CALC_SERVER=127.0.0.1
\end{verbatim}

To see the processes, open another terminal go to the root directory of diFX, source setup.bash and then run

It will display the processes taking place in the calculation, I attached a text file with that info.
\begin{verbatim}
>> errormon2
\end{verbatim}

\item When all this is done, one can try the example files, for the RDV70 data,
\begin{verbatim}
>> vex2difx example.v2d
>> calcif2 example_1.calc
>> mpirun -np 8 mpifxcorr example_1.input
\end{verbatim}


\item When the correlation is done, you can get the FITS-LDI file from it in the following way,

\begin{verbatim}
>> difx2fits example_1.difx
\end{verbatim}


\end{enumerate}
   